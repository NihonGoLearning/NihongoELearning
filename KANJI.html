<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Kanji Learner ‚Äî Dark</title>
  <style>
    :root{
      --bg:#0b0f12; --card:#0f1720; --muted:#9aa6b2; --accent:#7dd3fc; --green:#34d399; --red:#ff7b7b; --glass:rgba(255,255,255,0.03);
      --radius:12px; --gap:14px; --maxw:900px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,#071018 0%, #071018 50%, #08121a 100%); color:#e6eef6; display:flex; align-items:center; justify-content:center; padding:28px;
    }
    .app{width:100%; max-width:var(--maxw); background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-radius:20px; padding:24px; box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    header{display:flex; gap:12px; align-items:center; justify-content:space-between}
    .brand{display:flex; gap:12px; align-items:center}
    .logo{width:46px; height:46px; background:linear-gradient(90deg,var(--accent), #60a5fa); border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:700; color:#012; font-size:18px}
    h1{font-size:18px; margin:0}
    p.lead{margin:0; color:var(--muted); font-size:13px}

    .main{display:grid; grid-template-columns: 1fr 360px; gap:18px; margin-top:18px}
    @media (max-width:900px){.main{grid-template-columns:1fr}}

    .card{background:var(--card); border-radius:var(--radius); padding:18px; box-shadow:0 4px 18px rgba(2,6,23,0.6);}

    .kanji-box{height:220px; display:flex; align-items:center; justify-content:center; font-size:128px; border-radius:12px; background:var(--glass); margin-bottom:14px}
    .meta{display:flex; gap:12px; color:var(--muted); font-size:13px; align-items:center}

    label{display:block; font-size:13px; margin:8px 0 6px;color:var(--muted)}
    input[type=text]{width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit}
    .controls{display:flex; gap:10px; margin-top:12px}
    button{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border:1px solid rgba(255,255,255,0.04); color:inherit; padding:8px 10px; border-radius:10px; cursor:pointer}
    button.primary{background:linear-gradient(180deg,var(--accent),#60a5fa); color:#012; font-weight:600}
    .result{margin-top:12px; padding:10px; border-radius:10px; font-size:14px}
    .correct{background:rgba(52,211,153,0.08); border:1px solid rgba(52,211,153,0.12); color:var(--green)}
    .incorrect{background:rgba(255,123,123,0.06); border:1px solid rgba(255,123,123,0.08); color:var(--red)}

    .side {display:flex; flex-direction:column; gap:12px}
    .progress{height:12px; background:rgba(255,255,255,0.03); border-radius:999px; overflow:hidden}
    .progress > i{display:block; height:100%; background:linear-gradient(90deg,var(--accent),#60a5fa)}

    .list{max-height:220px; overflow:auto; padding:8px; border-radius:8px; background:rgba(255,255,255,0.01)}
    .list-item{display:flex; justify-content:space-between; padding:8px; border-radius:8px}
    .muted{color:var(--muted)}

    footer{display:flex; justify-content:space-between; align-items:center; margin-top:14px; color:var(--muted); font-size:13px}
    .small{font-size:12px}
    .hint{background:transparent; border:1px dashed rgba(255,255,255,0.04); padding:8px; border-radius:8px}

    .tags{display:flex; gap:8px; flex-wrap:wrap}
    .tag{background:rgba(255,255,255,0.02); border-radius:999px; padding:6px 8px; font-size:12px; color:var(--muted)}

    .kbd{background:rgba(0,0,0,0.35); padding:3px 6px; border-radius:6px; font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="app" role="application">
    <header>
      <div class="brand">
        <div class="logo">Êº¢</div>
        <div>
          <h1>Kanji Learner ‚Äî Dark</h1>
          <p class="lead">Enter all <strong>onyomi</strong> (Èü≥Ë™≠„Åø) and <strong>kunyomi</strong> (Ë®ìË™≠„Åø) readings for the shown kanji. Separate multiple readings with commas.</p>
        </div>
      </div>
      <div class="meta">
        <div class="tags"><span class="tag">Dark</span><span class="tag">Offline</span><span class="tag">LocalStorage</span></div>
      </div>
    </header>

    <div class="main">
      <div class="card">
        <div class="kanji-box" id="kanji">Êó•</div>
        <div class="meta"><div id="meaning" class="muted">meaning: sun / day</div></div>

        <label for="onyomi">Onyomi (Èü≥Ë™≠„Åø) ‚Äî usually in katakana. Example: „Éã„ÉÅ, „Ç∏„ÉÑ</label>
        <input id="onyomi" placeholder="Enter onyomi readings, comma separated">

        <label for="kunyomi">Kunyomi (Ë®ìË™≠„Åø) ‚Äî usually in hiragana. Example: „Å≤, -„Å≥, -„Åã</label>
        <input id="kunyomi" placeholder="Enter kunyomi readings, comma separated">

        <div class="controls">
          <button id="check" class="primary">Check</button>
          <button id="hint">Give hint</button>
          <button id="showAnswer">Show answer</button>
          <button id="next">Next ‚ûú</button>
          <button id="prev">‚óÇ Prev</button>
        </div>

        <div id="feedback" class="result" style="display:none"></div>

        <div style="display:flex; gap:12px; margin-top:12px; align-items:center">
          <div class="small muted">Progress</div>
          <div style="flex:1">
            <div class="progress" aria-hidden><i id="progBar" style="width:0%"></i></div>
          </div>
          <div id="score" class="small">0 / 0</div>
        </div>

        <footer>
          <div class="small muted">Tips: accept kana variants. Use commas to separate. Keyboard: Enter = Check, H = hint, S = show answer.</div>
          <div>
            <button id="reset">Reset</button>
          </div>
        </footer>
      </div>

      <aside class="side">
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
            <strong>Kanji list</strong>
            <div class="muted small">Click to jump</div>
          </div>
          <div class="list" id="kanjiList"></div>
        </div>

        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
            <strong>Settings</strong>
            <div class="muted small">Options</div>
          </div>
          <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px">
            <label><input type="checkbox" id="autoNext"> Auto next</label>
          </div>
          <div style="display:flex; gap:8px">
            <button id="shuffle">Shuffle</button>
            <button id="export">Export CSV</button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
// ------- small dataset (you can expand this) -------
const KANJI = [
  {kanji:'Êó•', meaning:'sun / day', onyomi:['„Éã„ÉÅ','„Ç∏„ÉÑ'], kunyomi:['„Å≤','-„Å≥','-„Åã']},
  {kanji:'Êúà', meaning:'moon / month', onyomi:['„Ç≤„ÉÑ','„Ç¨„ÉÑ'], kunyomi:['„Å§„Åç']},
  {kanji:'Â±±', meaning:'mountain', onyomi:['„Çµ„É≥'], kunyomi:['„ÇÑ„Åæ']},
  {kanji:'Â∑ù', meaning:'river', onyomi:['„Çª„É≥'], kunyomi:['„Åã„Çè','„Åå„Çè']},
  {kanji:'‰∫∫', meaning:'person', onyomi:['„Ç∏„É≥','„Éã„É≥'], kunyomi:['„Å≤„Å®']},
  {kanji:'Â§ß', meaning:'big / large', onyomi:['„ÉÄ„Ç§','„Çø„Ç§'], kunyomi:['„Åä„Åä','„Åä„Åä„Åç„ÅÑ']},
  {kanji:'Â∞è', meaning:'small', onyomi:['„Ç∑„Éß„Ç¶'], kunyomi:['„Å°„ÅÑ„Åï„ÅÑ','„Åì']},
  {kanji:'Ê∞¥', meaning:'water', onyomi:['„Çπ„Ç§'], kunyomi:['„Åø„Åö']},
  {kanji:'ÁÅ´', meaning:'fire', onyomi:['„Ç´'], kunyomi:['„Å≤','„Åª']},
  {kanji:'Êú®', meaning:'tree / wood', onyomi:['„Éú„ÇØ','„É¢„ÇØ'], kunyomi:['„Åç','„Åì']}
];

// ------- state -------
let idx = 0; let order = KANJI.map((_,i)=>i); let score = {}; let autoNext=false;

// ------- helpers -------
function katakanaToHiragana(s){
  return s.replace(/[„Ç°-„É∂]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0x60));
}
function hiraToKata(s){
  return s.replace(/[„ÅÅ-„Çñ]/g, ch => String.fromCharCode(ch.charCodeAt(0) + 0x60));
}
function normalizeReading(r){
  if(!r) return '';
  r = r.trim();
  // convert fullwidth spaces to normal
  r = r.replace(/\u3000/g,' ').toLowerCase();
  // convert katakana to hiragana for comparison
  r = katakanaToHiragana(r);
  // remove spaces and trailing dashes in okurigana like -„Å≥
  r = r.replace(/\s+/g,'');
  return r;
}
function parseInput(s){
  return s.split(',').map(x=>normalizeReading(x)).filter(Boolean);
}
function arraysEqual(a,b){
  if(a.length!==b.length) return false;
  const A = [...a].sort(); const B = [...b].sort();
  return A.every((v,i)=>v===B[i]);
}

// ------- UI bindings -------
const el = {
  kanji:document.getElementById('kanji'), meaning:document.getElementById('meaning'),
  onyomi:document.getElementById('onyomi'), kunyomi:document.getElementById('kunyomi'),
  check:document.getElementById('check'), hint:document.getElementById('hint'), showAnswer:document.getElementById('showAnswer'),
  next:document.getElementById('next'), prev:document.getElementById('prev'), feedback:document.getElementById('feedback'),
  progBar:document.getElementById('progBar'), score:document.getElementById('score'), kanjiList:document.getElementById('kanjiList'), reset:document.getElementById('reset'), shuffle:document.getElementById('shuffle'), exportBtn:document.getElementById('export'), autoNextChk:document.getElementById('autoNext')
}

function renderList(){
  el.kanjiList.innerHTML='';
  order.forEach((i,j)=>{
    const item = document.createElement('div'); item.className='list-item';
    item.innerHTML = `<div><strong>${KANJI[i].kanji}</strong> <span class="muted">${KANJI[i].meaning}</span></div><div class="muted">${j+1}</div>`;
    item.style.cursor='pointer';
    item.onclick = ()=>{ idx = j; showCard(); };
    el.kanjiList.appendChild(item);
  })
}

function showCard(){
  const data = KANJI[order[idx]];
  el.kanji.textContent = data.kanji;
  el.meaning.textContent = 'meaning: ' + data.meaning;
  el.onyomi.value = '';
  el.kunyomi.value = '';
  el.feedback.style.display='none';
  updateProgress();
}

function updateProgress(){
  const total = KANJI.length; const done = Object.keys(score).length; const percent = Math.round((done/total)*100);
  el.progBar.style.width = percent + '%'; el.score.textContent = `${done} / ${total}`;
}

function checkAnswer(){
  const data = KANJI[order[idx]];
  const userOn = parseInput(el.onyomi.value);
  const userKun = parseInput(el.kunyomi.value);

  const correctOn = data.onyomi.map(r=>normalizeReading(r));
  const correctKun = data.kunyomi.map(r=>normalizeReading(r));

  const onOK = arraysEqual(userOn, correctOn);
  const kunOK = arraysEqual(userKun, correctKun);

  const bothOK = onOK && kunOK;
  el.feedback.style.display='block';
  if(bothOK){
    el.feedback.className='result correct'; el.feedback.textContent = 'Correct! üéâ';
    score[order[idx]] = true;
  } else {
    el.feedback.className='result incorrect';
    let msg = 'Not quite.\n';
    msg += `Onyomi matched: ${onOK ? 'Yes' : 'No'}; Kunyomi matched: ${kunOK ? 'Yes' : 'No'}.`;
    el.feedback.textContent = msg;
    score[order[idx]] = false;
  }
  saveState(); updateProgress();
  if(bothOK && autoNext){ nextCard(); }
}

function showAnswer(){
  const data = KANJI[order[idx]];
  const on = data.onyomi.join(', ');
  const kun = data.kunyomi.join(', ');
  el.feedback.style.display='block'; el.feedback.className='result'; el.feedback.textContent = `Answer ‚Äî Onyomi: ${on} \nKunyomi: ${kun}`;
}

function hint(){
  const data = KANJI[order[idx]];
  // reveal one onyomi + one kunyomi (if available)
  const hOn = data.onyomi[0] || '‚Äî';
  const hKun = data.kunyomi[0] || '‚Äî';
  el.feedback.style.display='block'; el.feedback.className='result'; el.feedback.textContent = `Hint ‚Äî Onyomi includes: ${hOn}; Kunyomi includes: ${hKun}`;
}

function nextCard(){ idx = (idx+1) % order.length; showCard(); }
function prevCard(){ idx = (idx-1 + order.length) % order.length; showCard(); }

function shuffleList(){
  for(let i=order.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [order[i],order[j]]=[order[j],order[i]]; }
  idx=0; renderList(); showCard(); saveState();
}

function exportCSV(){
  const rows = [['kanji','meaning','onyomi (expected)','kunyomi (expected)','userCorrect']];
  KANJI.forEach((k,i)=>{
    const s = score[i]===true ? 'true' : (score[i]===false ? 'false' : '');
    rows.push([k.kanji, k.meaning, k.onyomi.join('|'), k.kunyomi.join('|'), s]);
  });
  const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='kanji_progress.csv'; a.click(); URL.revokeObjectURL(url);
}

function saveState(){
  try{
    localStorage.setItem('kanji_order', JSON.stringify(order));
    localStorage.setItem('kanji_idx', idx);
    localStorage.setItem('kanji_score', JSON.stringify(score));
    localStorage.setItem('kanji_autoNext', autoNext);
  }catch(e){console.warn('localStorage failed',e)}
}
function loadState(){
  try{
    const o = JSON.parse(localStorage.getItem('kanji_order')||'null');
    if(Array.isArray(o) && o.length===KANJI.length) order=o;
    const ii = parseInt(localStorage.getItem('kanji_idx')); if(!isNaN(ii)) idx=ii;
    const s = JSON.parse(localStorage.getItem('kanji_score')||'{}'); score = s || {};
    autoNext = (localStorage.getItem('kanji_autoNext')==='true'); el.autoNextChk.checked = autoNext;
  }catch(e){/*ignore*/}
}

// ------- events -------
el.check.onclick = checkAnswer; el.hint.onclick = hint; el.showAnswer.onclick = showAnswer;
el.next.onclick = nextCard; el.prev.onclick = prevCard; el.shuffle.onclick = shuffleList; el.exportBtn.onclick = exportCSV;
el.reset.onclick = ()=>{ if(confirm('Reset progress and ordering?')){ order = KANJI.map((_,i)=>i); idx=0; score={}; saveState(); renderList(); showCard(); }};
el.autoNextChk.onchange = (e)=>{ autoNext = e.target.checked; saveState(); };

// keyboard
window.addEventListener('keydown', e=>{
  if(e.key==='Enter'){ e.preventDefault(); checkAnswer(); }
  if(e.key.toLowerCase()==='h'){ hint(); }
  if(e.key.toLowerCase()==='s'){ showAnswer(); }
  if(e.key==='ArrowRight'){ nextCard(); }
  if(e.key==='ArrowLeft'){ prevCard(); }
});

// init
loadState(); renderList(); showCard();

  </script>
</body>
</html>